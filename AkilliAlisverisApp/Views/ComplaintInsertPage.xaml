<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:AkilliAlisverisApp.ViewModels"
             xmlns:mct="clr-namespace:CommunityToolkit.Maui.Behaviors;assembly=CommunityToolkit.Maui"
             x:Class="AkilliAlisverisApp.Views.ComplaintInsertPage"
             x:DataType="viewmodels:ComplaintInsertViewModel"
             Title="{Binding Title}">

    <ContentPage.Behaviors>
        <mct:EventToCommandBehavior EventName="Appearing"
                                    Command="{Binding LoadPageDataCommand}" />
    </ContentPage.Behaviors>

    <Grid RowDefinitions="Auto,*,Auto" RowSpacing="10" Padding="15">
        <ActivityIndicator IsRunning="{Binding IsBusy}" IsVisible="{Binding IsBusy}"
                           Grid.RowSpan="3"
                           HorizontalOptions="Center" VerticalOptions="Center" Color="{StaticResource Primary}" />

        <ScrollView Grid.Row="1">
            <VerticalStackLayout Spacing="15">

                <Label Text="Şikayet Konusu:" FontAttributes="Bold" TextColor="{StaticResource Primary}" />
                <Entry Placeholder="Şikayetinizin konusunu giriniz..."
                       Text="{Binding ComplaintSubject}"
                       ClearButtonVisibility="WhileEditing"
                       Keyboard="Text" />

                <Label Text="Şikayet İçeriği:" FontAttributes="Bold" TextColor="{StaticResource Primary}" />
                <Editor Placeholder="Şikayetinizin detaylarını açıklayınız..."
                        Text="{Binding ComplaintContent}"
                        AutoSize="TextChanges"
                        HeightRequest="100"
                        VerticalOptions="FillAndExpand"
                        Keyboard="Text" />

                <Label Text="Kategori Seçin:" FontAttributes="Bold" TextColor="{StaticResource Primary}" />
                <Picker Title="Kategori Seçiniz"
                        ItemsSource="{Binding ComplaintCategories}"
                        SelectedItem="{Binding SelectedCategory}" />

                <Label Text="Fotoğraf Ekle (İsteğe Bağlı):" FontAttributes="Bold" TextColor="{StaticResource Primary}" />
                <HorizontalStackLayout Spacing="10">
                    <Button Text="Fotoğraf Seç" Command="{Binding SelectPhotoCommand}" IsEnabled="{Binding IsNotBusy}"
                            Style="{StaticResource PrimaryButtonStyle}" />
                    <Button Text="Fotoğraf Çek" Command="{Binding TakePhotoCommand}" IsEnabled="{Binding IsNotBusy}"
                            Style="{StaticResource SecondaryButtonStyle}" />
                </HorizontalStackLayout>

                <Image Source="{Binding AttachedImageSource}"
                       IsVisible="{Binding AttachedImageSource, Converter={StaticResource NullToBoolConverter}}"
                       HeightRequest="200"
                       HorizontalOptions="Center"
                       Aspect="AspectFit" />

                <HorizontalStackLayout Spacing="10" VerticalOptions="Center">
                    <CheckBox IsChecked="{Binding IsLegalWarningAccepted}" />
                    <Label Text="Yasal uyarıyı okudum ve kabul ediyorum." VerticalOptions="Center">
                        <Label.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding ShowLegalWarningCommand}" />
                        </Label.GestureRecognizers>
                        <Label.FormattedText>
                            <FormattedString>
                                <Span Text="Yasal Uyarı" FontAttributes="Bold" TextColor="{StaticResource Accent}"/>
                                <Span Text="yı okudum ve kabul ediyorum." />
                            </FormattedString>
                        </Label.FormattedText>
                    </Label>
                </HorizontalStackLayout>

            </VerticalStackLayout>
        </ScrollView>

        <Button Grid.Row="2"
                Text="Gönder"
                Command="{Binding SubmitComplaintCommand}"
                IsEnabled="{Binding IsNotBusy}"
                Style="{StaticResource PrimaryButtonStyle}" />
    </Grid>
</ContentPage>